# Tarea 1.4 — Informe

Este informe corresponde a la sesion  de la Unidad 2 titulado Genética de poblaciones con software especializado
  
# Tarea 1.4 — Parte 1 Ejercicios relacionados a VCF  

Esta sección documenta en un script creado apra tal fin denominado **ya existe un script en Bash**tarea1_4.sh** exactamente con los **mismos comandos** que usé durante el desarrollo.

---

## Para ejecutar el script creado para estos ejercicios se puede seguir las siguientes indicaciones

~~~bash
cd Tarea\ 1.4
chmod +x code/tarea1_4.sh
bash code/tarea1_4.sh
~~~

- **Entrada**: los archivos indicados en cada pregunta deben estar en `data/`.
- **Salida**: el script escribe resultados (cuando corresponde) en `results/`.
- **Notas**: en el propio script se dejaron los **enunciados** (P1–P13) y, debajo, los **comandos** usados.

---
## A demás a modo de evidencia si incluyen todos los comandos y su ejecución dentro del servidor con las imagenes de los resultados obtenidos

## Enunciado del ejercicio: Escribe un script que responda lo siguiente para el archivo GATK_ChGdb_recalibrated.autosomes.12262013.snps.known.vcf  sin copiarlo a su directorio:
### P1 — Enunciado (captura)
> Ver captura **pregunta01.png**  
![P1](pregunta01.png)

---

### P2 — Enunciado (captura)
> Ver captura **pregunta02.png**  
![P2](pregunta02.png)

---

### P3 — Enunciado (captura)
> Ver captura **pregunta03.png**  
![P3](pregunta03.png)

---

### P4 — Enunciado (captura)
> Ver captura **pregunta04.png**  
![P4](pregunta04.png)

---

### P5 — Enunciado (captura)
> Ver capturas **pregunta05.png** (versión previa) y **pregunta05_vf.png** (versión final corregida)  
![P5 preliminar](pregunta05.png)  
![P5 final](pregunta05_vf.png)

---

### P6 — Enunciado (captura)
> Ver captura **pregunta06.png**  
![P6](pregunta06.png)

---

### P7 — Enunciado (captura)
> Ver captura **pregunta07.png**  
![P7](pregunta07.png)

---

### P8 — Enunciado (captura)
> Ver captura **pregunta08.png**  
![P8](pregunta08.png)

---

### P9 — Enunciado (captura)
> Ver captura **pregunta09.png**  
![P9](pregunta09.png)

---

### P10 — Enunciado (captura)
> Ver captura **pregunta10.png**  
![P10](pregunta10.png)

---

### P11 — Enunciado (captura)
> Ver captura **pregunta11.png**  
![P11](pregunta11.png)

---

### P12 — Enunciado (captura)
> Ver captura **pregunta12.png**  
![P12](pregunta12.png)

---

### P13 — Enunciado (captura)
> Ver captura **pregunta13.png**  
![P13](pregunta13.png)

---

## Observaciones

- El **script en `code/`** contiene, para cada pregunta, el **enunciado textual** y los **comandos exactos** que utilicé (fiables con las capturas).  
- Las **imágenes** se referencian por su **nombre exacto**. Una vez subidas al repositorio, GitHub mostrará cada captura embebida en esta sección del README.

#(Ejercicio 4)

**Directorio de trabajo:** `Tarea 1.4/`  

## Estructura
~~~
Tarea 1.4/
├── code/      # scripts (R y bash)
├── data/      # entradas: PLINK + metadatos
└── results/   # salidas intermedias y finales
~~~

## Software
- R 4.4.3 (`/opt/R/R-4.4.3/bin/Rscript`)
- PLINK 1.9 (`/opt/plink/plink-1.90/plink`)

---

## Objetivo del Ejercicio 4

Usar `data/chilean_all48_hg19_popinfo.csv` y el comando `plink --update-ids` para **cambiar el FID** de las muestras del set PLINK `data/chilean_all48_hg19.{bed,bim,fam}`, de manera que el **FID** pase a ser **`Categ.Altitud`** tomado desde el metadato de maíz `data/maizteocintle_SNP50k_meta_extended.txt`.

> Para que esto sea posible debe existir una **llave en común** (columna con valores coincidentes) entre las 48 muestras de `popinfo` y las filas relevantes del meta de maíces; sin una llave, no se puede construir la tabla requerida por `--update-ids`:
> ~~~
> oldFID  oldIID  newFID  newIID
> ~~~

---

## Entradas utilizadas
- `data/chilean_all48_hg19.{bed,bim,fam}`
- `data/chilean_all48_hg19_popinfo.csv`
- `data/maizteocintle_SNP50k_meta_extended.txt`

---

## Pasos realizados

### 1) Extraer IDs del `.fam`

**Script:** `code/step4a_extract_fam_ids.R`  
**Comando:**
~~~bash
/opt/R/R-4.4.3/bin/Rscript code/step4a_extract_fam_ids.R
~~~

**Salida principal**
- `results/fam_ids.tsv` — columnas: `oldFID`, `oldIID`, `IID_STD` (ID estandarizado).

> *Nota:* Este paso se usó para comparar correctamente los IIDs del `.fam` con campos de `popinfo` y asegurar que estamos trabajando sobre las mismas 48 muestras.

---

### 2) Escaneo de llaves entre `popinfo` y el meta

Para **no asumir** cuál es la llave, se escanearon **todas** las columnas de `popinfo` contra **todas** las columnas del archivo `maizteocintle_SNP50k_meta_extended.txt`, contando coincidencias tras una normalización (mayúsculas, `trim`, y eliminación de acentos/ñ).

**Script:** `code/step4z_scan_keys.R`  
**Comando:**
~~~bash
/opt/R/R-4.4.3/bin/Rscript code/step4z_scan_keys.R
~~~

**Salidas**
- `results/key_scan_fam_pop.tsv` — confirma que **`IndID`** de `popinfo` **matchea 48/48** con los IIDs del `.fam`.
- `results/key_scan_pop_meta.tsv` — **todas** las combinaciones `pop_col × meta_col` tienen **`matches = 0`**.

**Interpretación**
- Aunque `IndID` enlaza perfecto `fam ↔ popinfo`, **no existe llave** con el meta de maíces.  
- Columnas candidatas como `Num_Colecta`, `NSiembra`, `OrderColecta`, `Categ.Altitud`, etc., **no presentan intersección de valores** con estas 48 muestras.

---

### 3) Consecuencia sobre `plink --update-ids`

Dado que **no hay llave en común**, **no se puede** construir la tabla de 4 columnas `oldFID oldIID newFID newIID` con `newFID = Categ.Altitud` del meta.  
Por lo tanto, **no se ejecutó** el siguiente comando:

~~~bash
/opt/plink/plink-1.90/plink \
  --bfile data/chilean_all48_hg19 \
  --update-ids results/update_ids.txt \
  --make-bed \
  --out results/chilean_all48_hg19_altfid
~~~

---

## Evidencia

1) **`results/key_scan_fam_pop.tsv`**  
Confirma que `IndID` (en `popinfo`) coincide **48/48** con los IIDs del `.fam`.  
➡️ `popinfo` corresponde a las mismas 48 muestras del `.fam`.

2) **`results/key_scan_pop_meta.tsv`**  
Todas las filas muestran **`matches = 0`** para cualquier par `pop_col × meta_col`.  
➡️ **No existe llave** entre `popinfo` (48 chilenos) y `maizteocintle_SNP50k_meta_extended.txt`.

---

## Conclusión del Ejercicio 4

Con el escaneo exhaustivo de llaves, se concluye que **no existe una llave común** entre las 48 muestras chilenas y el metadato de maíces. En consecuencia, **no es posible** renombrar el FID a `Categ.Altitud` usando `plink --update-ids` para este conjunto de datos.  
Se documenta el intento, los scripts utilizados y la evidencia generada. Se continúa con los **Ejercicios 5–7**, que solo requieren `fam` y `popinfo`.

> **Plan B (no aplicado para respetar el enunciado):** podría derivarse una categoría de altitud **directamente desde `popinfo`** (si existe una columna numérica o categórica equivalente) y usarla en `--update-ids`. En este informe se **opta por no hacerlo** porque la consigna exige explícitamente **`Categ.Altitud` del meta** de maíces.

---

## Reproducibilidad rápida

Desde `Tarea 1.4/`:

~~~bash
# 1) Extraer IDs del fam
/opt/R/R-4.4.3/bin/Rscript code/step4a_extract_fam_ids.R

# 2) Escanear llaves popinfo × meta
/opt/R/R-4.4.3/bin/Rscript code/step4z_scan_keys.R
~~~

**Revisar:**
- `results/fam_ids.tsv`
- `results/key_scan_fam_pop.tsv`
- `results/key_scan_pop_meta.tsv`  ← aquí se observa `matches = 0` para todas las parejas.

---

## Scripts y salidas (Ejercicio 4)

**Scripts**
- `code/step4a_extract_fam_ids.R`
- `code/step4z_scan_keys.R`

**Salidas**
- `results/fam_ids.tsv`
- `results/key_scan_fam_pop.tsv`
- `results/key_scan_pop_meta.tsv`

**Entradas**
- `data/chilean_all48_hg19.{bed,bim,fam}`
- `data/chilean_all48_hg19_popinfo.csv`
- `data/maizteocintle_SNP50k_meta_extended.txt`

